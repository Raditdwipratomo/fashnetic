<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Blockchain Implementation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .control-group h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #495057;
        }

        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .blockchain-display {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .block {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .block:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .block.valid {
            border-color: #28a745;
            background: linear-gradient(to right, #ffffff, #f8fff8);
        }

        .block.invalid {
            border-color: #dc3545;
            background: linear-gradient(to right, #ffffff, #fff8f8);
        }

        .block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .block-index {
            font-size: 1.2em;
            font-weight: bold;
            color: #495057;
        }

        .block-timestamp {
            font-size: 0.9em;
            color: #6c757d;
        }

        .block-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .block-field {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
        }

        .block-field-label {
            font-size: 0.8em;
            color: #6c757d;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .block-field-value {
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            word-break: break-all;
        }

        .hash {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: 600;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #6c757d;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .log {
            background: #212529;
            color: #28a745;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
            border-bottom: 1px solid #495057;
        }

        .log-timestamp {
            color: #6c757d;
            margin-right: 10px;
        }

        @media (max-width: 768px) {
            .controls {
                grid-template-columns: 1fr;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .block-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîó Simple Blockchain</h1>
            <p>A JavaScript implementation of a basic blockchain with Proof of Work</p>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="blockCount">0</div>
                <div class="stat-label">Total Blocks</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="difficulty">2</div>
                <div class="stat-label">Mining Difficulty</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalTransactions">0</div>
                <div class="stat-label">Total Transactions</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="chainValid">‚úÖ</div>
                <div class="stat-label">Chain Status</div>
            </div>
        </div>

        <div class="controls">
            <div class="control-group">
                <h3>üì¶ Add New Transaction</h3>
                <div class="form-group">
                    <label for="fromAddress">From Address:</label>
                    <input type="text" id="fromAddress" placeholder="Enter sender address">
                </div>
                <div class="form-group">
                    <label for="toAddress">To Address:</label>
                    <input type="text" id="toAddress" placeholder="Enter recipient address">
                </div>
                <div class="form-group">
                    <label for="amount">Amount:</label>
                    <input type="number" id="amount" placeholder="Enter amount" step="0.01">
                </div>
                <button class="btn" onclick="addTransaction()">Add Transaction</button>
            </div>

            <div class="control-group">
                <h3>‚õèÔ∏è Mining Operations</h3>
                <div class="form-group">
                    <label for="minerAddress">Miner Address:</label>
                    <input type="text" id="minerAddress" placeholder="Enter miner address">
                </div>
                <div class="form-group">
                    <label for="miningReward">Mining Reward:</label>
                    <input type="number" id="miningReward" value="100" step="0.01">
                </div>
                <button class="btn" onclick="minePendingTransactions()" id="mineBtn">Mine Pending Transactions</button>
            </div>

            <div class="control-group">
                <h3>üîß Blockchain Controls</h3>
                <div class="form-group">
                    <label for="difficultyInput">Mining Difficulty:</label>
                    <select id="difficultyInput" onchange="updateDifficulty()">
                        <option value="1">1 (Very Easy)</option>
                        <option value="2" selected>2 (Easy)</option>
                        <option value="3">3 (Medium)</option>
                        <option value="4">4 (Hard)</option>
                        <option value="5">5 (Very Hard)</option>
                    </select>
                </div>
                <button class="btn" onclick="validateChain()">Validate Chain</button>
                <button class="btn" onclick="getBalance()" style="margin-top: 10px;">Check Balance</button>
            </div>

            <div class="control-group">
                <h3>üí∞ Balance Checker</h3>
                <div class="form-group">
                    <label for="balanceAddress">Address:</label>
                    <input type="text" id="balanceAddress" placeholder="Enter address to check balance">
                </div>
                <div class="form-group">
                    <label>Current Balance:</label>
                    <div id="currentBalance" style="font-size: 1.2em; font-weight: bold; color: #28a745;">0.00</div>
                </div>
            </div>
        </div>

        <div class="blockchain-display">
            <h3>üîó Blockchain Explorer</h3>
            <div id="blockchainContainer">
                <!-- Blocks will be displayed here -->
            </div>
        </div>

        <div class="log" id="miningLog">
            <div class="log-entry">
                <span class="log-timestamp">[SYSTEM]</span>
                <span>Blockchain initialized with Genesis Block</span>
            </div>
        </div>
    </div>

    <script>
        // Crypto-JS alternative - Simple SHA256 implementation
        function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            return crypto.subtle.digest('SHA-256', msgBuffer).then(hashBuffer => {
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                return hashHex;
            });
        }

        // Synchronous hash function for mining
        function simpleHash(str) {
            let hash = 0;
            if (str.length === 0) return hash.toString();
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convert to 32-bit integer
            }
            return Math.abs(hash).toString(16).padStart(8, '0');
        }

        // Transaction Class
        class Transaction {
            constructor(fromAddress, toAddress, amount) {
                this.fromAddress = fromAddress;
                this.toAddress = toAddress;
                this.amount = amount;
                this.timestamp = Date.now();
            }
        }

        // Block Class
        class Block {
            constructor(timestamp, transactions, previousHash = '') {
                this.timestamp = timestamp;
                this.transactions = transactions;
                this.previousHash = previousHash;
                this.hash = this.calculateHash();
                this.nonce = 0;
            }

            calculateHash() {
                return simpleHash(this.previousHash + this.timestamp + JSON.stringify(this.transactions) + this.nonce);
            }

            mineBlock(difficulty) {
                const target = Array(difficulty + 1).join("0");
                
                while (this.hash.substring(0, difficulty) !== target) {
                    this.nonce++;
                    this.hash = this.calculateHash();
                    
                    // Add progress update every 10000 iterations
                    if (this.nonce % 10000 === 0) {
                        logMining(`Mining... Nonce: ${this.nonce}, Hash: ${this.hash}`);
                    }
                }

                logMining(`Block mined: ${this.hash}`);
            }
        }

        // Blockchain Class
        class Blockchain {
            constructor() {
                this.chain = [this.createGenesisBlock()];
                this.difficulty = 2;
                this.pendingTransactions = [];
                this.miningReward = 100;
            }

            createGenesisBlock() {
                return new Block(Date.now(), [], "0");
            }

            getLatestBlock() {
                return this.chain[this.chain.length - 1];
            }

            minePendingTransactions(miningRewardAddress) {
                const rewardTransaction = new Transaction(null, miningRewardAddress, this.miningReward);
                this.pendingTransactions.push(rewardTransaction);

                const block = new Block(Date.now(), this.pendingTransactions, this.getLatestBlock().hash);
                block.mineBlock(this.difficulty);

                logMining(`Block successfully mined!`);
                this.chain.push(block);
                this.pendingTransactions = [];
            }

            createTransaction(transaction) {
                this.pendingTransactions.push(transaction);
            }

            getBalance(address) {
                let balance = 0;

                for (const block of this.chain) {
                    for (const trans of block.transactions) {
                        if (trans.fromAddress === address) {
                            balance -= trans.amount;
                        }

                        if (trans.toAddress === address) {
                            balance += trans.amount;
                        }
                    }
                }

                return balance;
            }

            isChainValid() {
                for (let i = 1; i < this.chain.length; i++) {
                    const currentBlock = this.chain[i];
                    const previousBlock = this.chain[i - 1];

                    if (currentBlock.hash !== currentBlock.calculateHash()) {
                        return false;
                    }

                    if (currentBlock.previousHash !== previousBlock.hash) {
                        return false;
                    }
                }

                return true;
            }
        }

        // Initialize blockchain
        let blockchain = new Blockchain();

        // Utility functions
        function logMining(message) {
            const logContainer = document.getElementById('miningLog');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `<span class="log-timestamp">[${timestamp}]</span><span>${message}</span>`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function updateStats() {
            document.getElementById('blockCount').textContent = blockchain.chain.length;
            document.getElementById('difficulty').textContent = blockchain.difficulty;
            
            let totalTransactions = 0;
            blockchain.chain.forEach(block => {
                totalTransactions += block.transactions.length;
            });
            document.getElementById('totalTransactions').textContent = totalTransactions;
            
            const isValid = blockchain.isChainValid();
            document.getElementById('chainValid').textContent = isValid ? '‚úÖ' : '‚ùå';
        }

        function renderBlockchain() {
            const container = document.getElementById('blockchainContainer');
            container.innerHTML = '';

            blockchain.chain.forEach((block, index) => {
                const blockElement = document.createElement('div');
                blockElement.className = `block ${blockchain.isChainValid() ? 'valid' : 'invalid'}`;
                
                const transactionsHtml = block.transactions.map(tx => 
                    `<div style="margin: 5px 0; padding: 5px; background: #e9ecef; border-radius: 3px;">
                        ${tx.fromAddress || 'System'} ‚Üí ${tx.toAddress}: ${tx.amount}
                    </div>`
                ).join('');

                blockElement.innerHTML = `
                    <div class="block-header">
                        <div class="block-index">Block #${index}</div>
                        <div class="block-timestamp">${new Date(block.timestamp).toLocaleString()}</div>
                    </div>
                    <div class="block-details">
                        <div class="block-field">
                            <div class="block-field-label">Previous Hash</div>
                            <div class="block-field-value">${block.previousHash}</div>
                        </div>
                        <div class="block-field">
                            <div class="block-field-label">Hash</div>
                            <div class="block-field-value hash">${block.hash}</div>
                        </div>
                        <div class="block-field">
                            <div class="block-field-label">Nonce</div>
                            <div class="block-field-value">${block.nonce}</div>
                        </div>
                        <div class="block-field">
                            <div class="block-field-label">Transactions (${block.transactions.length})</div>
                            <div class="block-field-value">${transactionsHtml || 'No transactions'}</div>
                        </div>
                    </div>
                `;
                
                container.appendChild(blockElement);
            });
        }

        // Event handlers
        function addTransaction() {
            const fromAddress = document.getElementById('fromAddress').value;
            const toAddress = document.getElementById('toAddress').value;
            const amount = parseFloat(document.getElementById('amount').value);

            if (!fromAddress || !toAddress || !amount) {
                alert('Please fill in all transaction fields');
                return;
            }

            const transaction = new Transaction(fromAddress, toAddress, amount);
            blockchain.createTransaction(transaction);

            logMining(`Transaction added: ${fromAddress} ‚Üí ${toAddress} (${amount})`);
            
            // Clear form
            document.getElementById('fromAddress').value = '';
            document.getElementById('toAddress').value = '';
            document.getElementById('amount').value = '';

            updateStats();
        }

        function minePendingTransactions() {
            const minerAddress = document.getElementById('minerAddress').value;
            const miningReward = parseFloat(document.getElementById('miningReward').value);

            if (!minerAddress) {
                alert('Please enter miner address');
                return;
            }

            if (blockchain.pendingTransactions.length === 0) {
                alert('No pending transactions to mine');
                return;
            }

            blockchain.miningReward = miningReward;
            const mineBtn = document.getElementById('mineBtn');
            mineBtn.disabled = true;
            mineBtn.innerHTML = '<span class="spinner"></span>Mining...';

            // Use setTimeout to prevent UI blocking
            setTimeout(() => {
                logMining(`Starting mining process...`);
                blockchain.minePendingTransactions(minerAddress);
                
                mineBtn.disabled = false;
                mineBtn.innerHTML = 'Mine Pending Transactions';
                
                updateStats();
                renderBlockchain();
            }, 100);
        }

        function updateDifficulty() {
            const difficulty = parseInt(document.getElementById('difficultyInput').value);
            blockchain.difficulty = difficulty;
            logMining(`Mining difficulty updated to: ${difficulty}`);
            updateStats();
        }

        function validateChain() {
            const isValid = blockchain.isChainValid();
            logMining(`Chain validation result: ${isValid ? 'VALID' : 'INVALID'}`);
            updateStats();
            renderBlockchain();
        }

        function getBalance() {
            const address = document.getElementById('balanceAddress').value;
            if (!address) {
                alert('Please enter an address to check balance');
                return;
            }

            const balance = blockchain.getBalance(address);
            document.getElementById('currentBalance').textContent = balance.toFixed(2);
            logMining(`Balance for ${address}: ${balance}`);
        }

        // Auto-update balance when address changes
        document.getElementById('balanceAddress').addEventListener('input', function() {
            const address = this.value;
            if (address) {
                const balance = blockchain.getBalance(address);
                document.getElementById('currentBalance').textContent = balance.toFixed(2);
            }
        });

        // Initialize display
        updateStats();
        renderBlockchain();

        // Add some sample data
        setTimeout(() => {
            logMining('Blockchain ready! Add some transactions and start mining.');
        }, 1000);
    </script>
</body>